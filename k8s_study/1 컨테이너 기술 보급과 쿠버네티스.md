# 1. 컨테이너 기술 보급과 쿠버네티스

---

### 쿠버네티스를 사용해야 하는 이유

- 서비스가 커지면 여러 컨테이너를 연결해 하나의 서비스를 만들게 된다.
- 이런 구성에 문제가 있는것이, **통신과 가용성 확보**가 있다.
- 예를들어,
    - 컨테이너가 스케일 아웃을 하는 경우 상단에 있는 로드밸런서에 어떻게 연결하는것이 좋은가에 대한 문제해결
    - 가상 머신 1대 안에서 컨테이너 여러개를 동작시키는 경우 리소스 제어
    - 한쪽 컨테이너에 부하가 높아져도 다른 한쪽 컨테이너의 성능이 떨어지지 않게 하는 다중화
    - 컨테이너가 동작하는 가상 머신에 장애가 생겨 모든 컨테이너가 정지되고 서비스 전체가 멈춰버리는 현상을 막기 위해
    
    ---
    

### 쿠버네티스 개념

- **데이터 플레인**(서비스 사이의 네트워크 트래픽을 관리하는 서비스 메시(애플리케이션의 다양한 부분들이 통신하는 것을 제어하는 방법) 애플리케이션을 뜻함) 이라고 하는 서버를 여러 대 실행시켜 그 위에 가상 오케스트레이션 계층을 구축하고 거기에서 컨테이너가 동작한다.
- 쿠버네티스는 어떤 가상 머신에서 어느 정도의 컨테이너를 동작시킬지를 관리하거나
- 새로운 컨테이너를 배포할 때 어떤 가상 머신에 배포하면 좋을지 등을 자동으로 판단한다.
- 장애가 발생한 컨테이너를 정지시키고 재시작하는 구조도 갖고 있다.
- 이러한 기능은 **컨트롤 플레인**(데이터 플레인이 어떻게 동작할지 설정하는 애플리케이션을 뜻함) 이라는 마스터 노드 그룹에서 구현화 된다

---

### 쿠버네티스의 기본 오브젝트

- 파드(Pod)
    - 파드는 쿠버네티스의 최소 단위며, 파드 하나 안에서는 하나 이상의 컨테이너를 동작시킬 수 있다. 파드에는 어떤 컨테이너 이미지를 사용할지 등을 설정한다.
- 레플리카셋(ReplicaSet)
    - 레플리카셋은 파드를 얼마나 동작시킬지 관리하는 오브젝트이다. 레플리카셋에서 파드의 수를 설정하면 그만큼의 파드가 동작하는 것을 보장한다.
- 디플로이먼트(Deployment)
    - 디플로이먼트는 이름 그대로 배포 이력을 관리한다.
    - 쿠버네티스 운영 중에는 애플리케이션의 새로운 버전을 릴리스 하거나 부하증가에 따라 레플리카셋 수를 변경하는 등 여러 가지 동작이 발생하는데 이들을 디플로이먼트로 관리 할 수있다.
    - 디플로이먼트는 적용 이력도 관리하므로 새로운 버전의 애플리케이션 릴리스 이후 문제가 발생하면 바로 이전 버전으로 쉽게 롤백할 수 있다.
    - 서비스를 운영하는 상황 대부분에서 파드를 동작시킬 때는 디플로이먼트 단위로 관리한다.
- 서비스(Service)
    - 서비스는 배포한 파드를 쿠버네티스 클러스터 외부에 공개하기 위한 구조를 제공한다.
    - 여러 방법이 있지만 대표적으로 로드밸런서를 사용하는 것이 있다.
    - 클러스터 내에 파드 여러 개를 동작시킨 경우 그 앞단에 로드밸런서를 배치하여 특정 파드를 클러스터 외부로 공개할 수 있다.

---

### Amazon EKS란?

- 쿠버네티스를 제어하는 컨트롤 플레인을 제공하는 관리형 서비스다.
- 쿠버네티스에서는 여러 컴포넌트들이 서로 독립적이고 비동기로 동작하여 전체를 구성한다.
- 각각의 구성 요소를 정상적으로 동작시키기 위한 설정이나 유지, 운영 장애가 발생했을 떄의 복구 방법은 간단하지 않는데 EKS는 이런 유지 운영을 AWS에서 대신해준다.

---

### EKS의 특징

- VPC와 통합
    - 일반적으로 쿠버네티스 클러스터에서는 파드 네트워크로 데이터 플레인의 네트워크와는 다른 자체 네트워크 체계를 배치한다.
    - 클러스트 외부에서 파드에 명시적으로 엔드포인트를 생성하지 않으면 통신이 불가능하다.
    - EKS에서는 Amazon VPC 통합 네트워킹을 지원하고 있어, 파드에서 VPC 내부 주소 대역을 사용할 수 있고 클러스터 외부와의 통신을 심리스하게 구현할 수 있다.
- IAM을 통한 인증과 인가
    - 쿠버네티스 클러스터는 kubectl이라는 명령줄 도구를 사용하여 조작한다.
    - 조작이 허가된 사용자에 의한 것임을 올바르게 인증(authentication)해야 한다.
    - 또한 인증된 사용자에게 어떤 조작을 허가할지에 대한 인가(authorization)구조도 필요하다.
    - EKS에서는 IAM과 연결한 인증 및 인가 구조를 제공한다.
- ELB와의 연계
    - 쿠버네티스 클러스터 외부에서 접속할 때는 서비스를 사용해 엔드포인트를 생성할 필요가 있다.
    - **가장 전형적인 엔드포인트가 로드밸런서이다.**
    - EKS에서는 쿠버네티스의 서비스 타입 중 하나인 로드밸런서를 설정하면 자동적으로 AWS의 로드밸런서 서비스인 ELB(Elastic Load Balancing)가 생성된다. 이것으로 HTTPS나 경로 기반 라우팅 등의  L7 로드 밸런서 기능을 AWS 서비스로 구현할 수 있다.
- 데이터 플레인 선택
    - 쿠버네티스는 `컨트롤 플레인`과 `데이터 플레인`으로 구성된다.
    - 컨트롤 플레인은 EKS에서 관리형 서비스로 제공되고 있다. 그렇다면 데이터 플레인은??
    - EC2의 경우 EKS와 별도로 EC2를 관리해야하고,
    - 관리형 노드 그룹은 EC2임에는 변함이 없지만 EKS에 통합된 데이터 플레인으로 동작한다.
    유지보수나 버전을 업데이트할 때 필요한 조작이나 고려 사항들을 자동적으로 실행함.
    - Fargate: 데이터 플레인도 완전히 AWS가 관리하며 사용자는 EC2를 관리하지 않아도 됨.
        - 하지만 파게이트는 저 위 2개의 옵션보다 관리부하가 적은대신 제약이 많다.
-